webpackJsonp([4],{CaIC:function(t,e){},iKG6:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("//Fk"),i=a.n(n),r=[{title:"刷卡时间",dataIndex:"DisplayTime",align:"center",width:40},{title:"门禁卡号",dataIndex:"BadgeCode",align:"center",width:20},{title:"卡类型",dataIndex:"Type",align:"center",width:20},{title:"持卡人",dataIndex:"Cardholder",align:"center",width:20},{title:"控制器编号",dataIndex:"EquipmentId",align:"center",width:20},{title:"设备名称（门）",dataIndex:"Equipment",align:"center",width:20},{title:"安全级别",dataIndex:"Security",align:"center",width:20},{title:"结果",dataIndex:"Result",align:"center",width:20}],l={name:"card-log-manage",components:{AFormItem:a("SWcn").a},data:function(){var t=this;return{columns:r,expandAllRows:!0,pagination:{current:1,defaultCurrent:1,defaultPageSize:20,total:0,size:"large",onChange:function(e){return t.changePage(e)}},loading:!1,equipments:[],tableData:[],tableList:[],filterList:[],badgeCode:"",equipmentId:"",starttime:null,endtime:null}},beforeCreate:function(){this.form=this.$form.createForm(this,{name:"advanced_search"})},created:function(){},beforeMount:function(){},mounted:function(){var t=this;this.loading=!0,this.$http.get(this.$api.getEquipments).then(function(e){console.log(e.data.value),t.equipments=e.data.value,t.initTable()})},methods:{initTable:function(){var t=this;t.loading=!0,t.form.validateFields(function(e,a){e||t.$http.get(t.$api.getTransactions).then(function(e){t.tableData=e.data.value,t.tableData.length,console.log(t.tableData);for(var a=0;a<t.tableData.length;a++){for(var n=t.tableData[a],i=n.Time,r=t.$common.timestampToTime(i),l=n.BadgeCode,o=n.Type,d=n.Cardholder,s=n.EquipmentId,u="",c="",m=n.Result,g=0;g<t.equipments.length;g++){var f=t.equipments[g];n.EquipmentId==f.EntityId&&(u=f.Name,c=f.JsonCustomColumn)}var h={Time:i,DisplayTime:r,BadgeCode:l,Type:o,Cardholder:d,EquipmentId:s,EquipmentName:u,Security:c,Result:m};t.tableList.push(h)}t.filterList=t.tableList,t.pagination.total=t.filterList.length,t.changePage(t.pagination.current)})})},searchFor:function(){var t=this;t.filterList=t.tableList,t.filterList=t.filterList.filter(function(e){return(e.BadgeCode+"").indexOf(t.badgeCode)>-1}),t.filterList=t.filterList.filter(function(e){return(e.EquipmentId+"").indexOf(t.equipmentId)>-1}),null!=t.starttime&&null!=t.endtime&&(t.filterList=t.filterList.filter(function(e){return new Date(e.Time).getTime()>new Date(t.starttime).getTime()&&new Date(e.Time).getTime()<new Date(t.endtime).getTime()})),t.pagination.total=t.filterList.length,t.pagination.current=1,t.changePage(t.pagination.current)},changePage:function(t){this.handleTableChange(t)},handleTableChange:function(t){for(var e=this,a=e.pagination.defaultPageSize,n=void 0,r=[],l=0;l<parseInt(a);l++)n=(t-1)*parseInt(a)+l,e.filterList[n]&&e.filterList[n].BadgeCode&&-1==r.indexOf(e.filterList[n].BadgeCode)&&r.push(e.filterList[n].BadgeCode);r.length?i.a.all([r.map(function(t){return e.getCardholder(t)})]).then(function(l){i.a.all(l[0]).then(function(i){i.map(function(i,l){n="";for(var o=0;o<parseInt(a);o++)if(n=(t-1)*parseInt(a)+o,e.filterList[n]&&e.filterList[n].BadgeCode==r[l]){var d=i.data.value;e.$set(e.filterList[n],"Cardholder",d)}}),e.pagination.current=t,e.loading=!1})}):(e.pagination.current=t,e.loading=!1)},getCardholder:function(t){var e=this;return new i.a(function(a,n){e.$http.get(e.$api.getCardholder+"'"+t+"'").then(function(t){a(t)})})},changeEquipment:function(t){this.equipmentId=t},changeStarttime:function(t){this.starttime=t},changeEndtime:function(t){this.endtime=t}}},o={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"card-log-manage"},[a("div",{staticClass:"search-condition"},[a("a-form",{attrs:{layout:"inline",form:t.form}},[a("a-form-item",{attrs:{label:"门禁卡号"}},[a("a-input",{attrs:{placeholder:"门禁卡号"},model:{value:t.badgeCode,callback:function(e){t.badgeCode=e},expression:"badgeCode"}})],1),t._v(" "),a("a-form-item",{attrs:{label:"设备名称"}},[a("div",[a("a-select",{staticStyle:{width:"150px"},attrs:{defaultValue:""},on:{change:t.changeEquipment}},[a("a-select-option",{attrs:{value:""}},[t._v("\n              全部\n            ")]),t._v(" "),t._l(t.equipments,function(e){return a("a-select-option",{key:e.EntityId},[t._v("\n              "+t._s(e.DisplayName)+"\n            ")])})],2)],1)]),t._v(" "),a("a-form-item",{attrs:{label:"开始时间"}},[a("a-date-picker",{attrs:{showTime:""},on:{change:t.changeStarttime}})],1),t._v(" "),a("a-form-item",{attrs:{label:"结束时间"}},[a("a-date-picker",{attrs:{showTime:""},on:{change:t.changeEndtime}})],1),t._v(" "),a("a-form-item",[a("a-button",{attrs:{type:"primary",icon:"search"},on:{click:t.searchFor}},[t._v("搜索")])],1),t._v(" "),a("a-form-item",[a("a-button",{attrs:{type:"primary",icon:"file"}},[t._v("导出")])],1)],1)],1),t._v(" "),a("div",{staticClass:"table"},[a("a-table",{attrs:{columns:t.columns,dataSource:t.filterList,pagination:t.pagination,loading:t.loading,defaultExpandAllRows:t.expandAllRows,size:"small"}})],1)])},staticRenderFns:[]};var d=a("VU/8")(l,o,!1,function(t){a("CaIC")},"data-v-872e3056",null);e.default=d.exports}});
//# sourceMappingURL=4.659211d73bf40e378dd8.js.map